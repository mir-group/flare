

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Build 2+3-body Mapped GP &mdash; flare 1.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=02f2166e"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Python Code Documentation" href="../flare/flare.html" />
    <link rel="prev" title="Training a 2+3-body Gaussian Process from an AIMD Run" href="gpfa.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            flare
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="colabs.html">FLARE: Active Learning Bayesian Force Fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="gpfa.html">Training a 2+3-body Gaussian Process from an AIMD Run</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Build 2+3-body Mapped GP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Parse-OTF-log-file">Parse OTF log file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Construct-GP-model-from-log-file">Construct GP model from log file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Map-the-GP-force-field-&amp;-Dump-LAMMPS-coefficient-file">Map the GP force field &amp; Dump LAMMPS coefficient file</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Run-LAMMPS-with-MGP-pair-style">Run LAMMPS with MGP pair style</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../flare/flare.html">Python Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../flare_pp/flare_pp.html">C++ Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../related.html">Applications/Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/contribute.html">How To Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">How to Cite</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">flare</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="tutorials.html">Tutorials</a></li>
      <li class="breadcrumb-item active">Build 2+3-body Mapped GP</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tutorials/after_training.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="Build-2+3-body-Mapped-GP">
<h1>Build 2+3-body Mapped GP<a class="headerlink" href="#Build-2+3-body-Mapped-GP" title="Link to this heading"></a></h1>
<p>After the on-the-fly training is complete, we can play with the force field we obtained. We are going to do the following things:</p>
<ol class="arabic simple">
<li><p>Parse the on-the-fly training trajectory to collect training data</p></li>
<li><p>Reconstruct the GP model from the training trajectory</p></li>
<li><p>Build up Mapped GP (MGP) for accelerated force field, and save coefficient file for LAMMPS</p></li>
<li><p>Use LAMMPS to run fast simulation using MGP pair style</p></li>
</ol>
<section id="Parse-OTF-log-file">
<h2>Parse OTF log file<a class="headerlink" href="#Parse-OTF-log-file" title="Link to this heading"></a></h2>
<p>After the on-the-fly training is complete, we have a log file and can use the <code class="docutils literal notranslate"><span class="pre">otf_parser</span></code> module to parse the trajectory.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flare</span><span class="w"> </span><span class="kn">import</span> <span class="n">otf_parser</span>

<span class="n">logdir</span> <span class="o">=</span> <span class="s1">&#39;../../../tests/test_files&#39;</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">logdir</span><span class="si">}</span><span class="s1">/AgI_snippet.out&#39;</span>
<span class="n">hyp_no</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># use the hyperparameters from the 2nd training step</span>
<span class="n">otf_object</span> <span class="o">=</span> <span class="n">otf_parser</span><span class="o">.</span><span class="n">OtfAnalysis</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Construct-GP-model-from-log-file">
<h2>Construct GP model from log file<a class="headerlink" href="#Construct-GP-model-from-log-file" title="Link to this heading"></a></h2>
<p>We can reconstruct GP model from the parsed log file (the on-the-fly training trajectory). Here we build up the GP model with 2+3 body kernel from the on-the-fly log file.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gp_model</span> <span class="o">=</span> <span class="n">otf_object</span><span class="o">.</span><span class="n">make_gp</span><span class="p">(</span><span class="n">hyp_no</span><span class="o">=</span><span class="n">hyp_no</span><span class="p">)</span>
<span class="n">gp_model</span><span class="o">.</span><span class="n">parallel</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">gp_model</span><span class="o">.</span><span class="n">hyp_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;sig2&#39;</span><span class="p">,</span> <span class="s1">&#39;ls2&#39;</span><span class="p">,</span> <span class="s1">&#39;sig3&#39;</span><span class="p">,</span> <span class="s1">&#39;ls3&#39;</span><span class="p">,</span> <span class="s1">&#39;noise&#39;</span><span class="p">]</span>

<span class="c1"># write model to a binary file</span>
<span class="n">gp_model</span><span class="o">.</span><span class="n">write_model</span><span class="p">(</span><span class="s1">&#39;AgI.gp&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The last step <code class="docutils literal notranslate"><span class="pre">write_model</span></code> is to write this GP model into a binary file, so next time we can directly load the model from the pickle file as</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">flare.gp</span><span class="w"> </span><span class="kn">import</span> <span class="n">GaussianProcess</span>

<span class="n">gp_model</span> <span class="o">=</span> <span class="n">GaussianProcess</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;AgI.gp.json&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Map-the-GP-force-field-&amp;-Dump-LAMMPS-coefficient-file">
<h2>Map the GP force field &amp; Dump LAMMPS coefficient file<a class="headerlink" href="#Map-the-GP-force-field-&-Dump-LAMMPS-coefficient-file" title="Link to this heading"></a></h2>
<p>To use the trained force field with accelerated version MGP, or in LAMMPS, we need to build MGP from GP model. Since 2-body and 3-body are both included, we need to set up the number of grid points for 2-body and 3-body in <code class="docutils literal notranslate"><span class="pre">grid_params</span></code>. We build up energy mapping, thus set <code class="docutils literal notranslate"><span class="pre">map_force=False</span></code>. See <a class="reference external" href="https://flare.readthedocs.io/en/latest/tutorials/mgp.html">MGP tutorial</a> for more explanation of the MGP settings.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">flare.mgp</span><span class="w"> </span><span class="kn">import</span> <span class="n">MappedGaussianProcess</span>

<span class="n">grid_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;twobody&#39;</span><span class="p">:</span>   <span class="p">{</span><span class="s1">&#39;grid_num&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">]},</span>
               <span class="s1">&#39;threebody&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;grid_num&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">]}}</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">gp_model</span><span class="o">.</span><span class="n">training_statistics</span>
<span class="n">lammps_location</span> <span class="o">=</span> <span class="s1">&#39;AgI_Molten&#39;</span>

<span class="n">mgp_model</span> <span class="o">=</span> <span class="n">MappedGaussianProcess</span><span class="p">(</span><span class="n">grid_params</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">],</span>
    <span class="n">var_map</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lmp_file_name</span><span class="o">=</span><span class="s1">&#39;AgI_Molten&#39;</span><span class="p">,</span> <span class="n">n_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">mgp_model</span><span class="o">.</span><span class="n">build_map</span><span class="p">(</span><span class="n">gp_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/yuxie/opt/anaconda3/lib/python3.8/site-packages/flare/mgp/mapxb.py:519: UserWarning: The minimal distance in training data is lower than the current lower bound, will reset lower bound to 2.129780094032889
  warnings.warn(
/Users/yuxie/opt/anaconda3/lib/python3.8/site-packages/flare/mgp/mapxb.py:519: UserWarning: The minimal distance in training data is lower than the current lower bound, will reset lower bound to 2.129780094032889
  warnings.warn(
/Users/yuxie/opt/anaconda3/lib/python3.8/site-packages/flare/mgp/mapxb.py:519: UserWarning: The minimal distance in training data is lower than the current lower bound, will reset lower bound to 2.129780094032889
  warnings.warn(
</pre></div></div>
</div>
<p>The coefficient file for LAMMPS mgp pair_style is automatically saved once the mapping is done. Saved as <code class="docutils literal notranslate"><span class="pre">lmp_file_name</span></code>.</p>
</section>
<section id="Run-LAMMPS-with-MGP-pair-style">
<h2>Run LAMMPS with MGP pair style<a class="headerlink" href="#Run-LAMMPS-with-MGP-pair-style" title="Link to this heading"></a></h2>
<p>With the above coefficient file, we can run LAMMPS simulation with the mgp pair style. First download our mgp pair style files, compile your lammps executable with mgp pair style following our <a class="reference external" href="https://flare.readthedocs.io/en/latest/installation/lammps.html">instruction</a> in the <em>Installation</em> section.</p>
<ol class="arabic simple">
<li><p>One way to use it is running <code class="docutils literal notranslate"><span class="pre">lmp_executable</span> <span class="pre">&lt;</span> <span class="pre">in.lammps</span> <span class="pre">&gt;</span> <span class="pre">log.lammps</span></code> with the executable provided in our repository. When creating the input file, please note to set</p></li>
</ol>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>newton off
pair_style mgp
pair_coeff * * &lt;lmp_file_name&gt; &lt;chemical_symbols&gt; yes/no yes/no
</pre></div>
</div>
<p>An example is using coefficient file <code class="docutils literal notranslate"><span class="pre">AgI_Molten.mgp</span></code> for AgI system, with two-body (the 1st <code class="docutils literal notranslate"><span class="pre">yes</span></code>) together with three-body (the 2nd <code class="docutils literal notranslate"><span class="pre">yes</span></code>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pair_coeff * * AgI_Molten.mgp Ag I yes yes
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Another way is to use the ASE LAMMPS interface</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flare.utils.element_coder</span><span class="w"> </span><span class="kn">import</span> <span class="n">_Z_to_mass</span><span class="p">,</span> <span class="n">_element_to_Z</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flare.ase.calculator</span><span class="w"> </span><span class="kn">import</span> <span class="n">FLARE_Calculator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ase.calculators.lammpsrun</span><span class="w"> </span><span class="kn">import</span> <span class="n">LAMMPS</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ase</span><span class="w"> </span><span class="kn">import</span> <span class="n">Atoms</span>

<span class="c1"># create test structure</span>
<span class="n">species</span> <span class="o">=</span> <span class="n">otf_object</span><span class="o">.</span><span class="n">gp_species_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">otf_object</span><span class="o">.</span><span class="n">position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">forces</span> <span class="o">=</span> <span class="n">otf_object</span><span class="o">.</span><span class="n">force_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">otf_cell</span> <span class="o">=</span> <span class="n">otf_object</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">]</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">Atoms</span><span class="p">(</span><span class="n">symbols</span><span class="o">=</span><span class="n">species</span><span class="p">,</span> <span class="n">cell</span><span class="o">=</span><span class="n">otf_cell</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="n">positions</span><span class="p">)</span>

<span class="c1"># get chemical symbols, masses etc.</span>
<span class="n">species</span> <span class="o">=</span> <span class="n">gp_model</span><span class="o">.</span><span class="n">training_statistics</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span>
<span class="n">specie_symbol_list</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
<span class="n">masses</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">_Z_to_mass</span><span class="p">[</span><span class="n">_element_to_Z</span><span class="p">[</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">species</span><span class="p">))]</span>

<span class="c1"># set up input params</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;command&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;lmp&#39;</span><span class="p">),</span> <span class="c1"># set up executable for ASE</span>
              <span class="s1">&#39;newton&#39;</span><span class="p">:</span> <span class="s1">&#39;off&#39;</span><span class="p">,</span>
              <span class="s1">&#39;pair_style&#39;</span><span class="p">:</span> <span class="s1">&#39;mgp&#39;</span><span class="p">,</span>
              <span class="s1">&#39;pair_coeff&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;* * </span><span class="si">{</span><span class="n">lammps_location</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;.mgp&quot;</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">specie_symbol_list</span><span class="si">}</span><span class="s1"> yes yes&#39;</span><span class="p">],</span>
              <span class="s1">&#39;mass&#39;</span><span class="p">:</span> <span class="n">masses</span><span class="p">}</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">lammps_location</span> <span class="o">+</span> <span class="s2">&quot;.mgp&quot;</span><span class="p">]</span>

<span class="c1"># create ASE calc</span>
<span class="n">lmp_calc</span> <span class="o">=</span> <span class="n">LAMMPS</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;tmp_AgI&#39;</span><span class="p">,</span> <span class="n">keep_tmp_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">tmp_dir</span><span class="o">=</span><span class="s1">&#39;./tmp/&#39;</span><span class="p">,</span>
        <span class="n">parameters</span><span class="o">=</span><span class="n">parameters</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">,</span> <span class="n">specorder</span><span class="o">=</span><span class="n">species</span><span class="p">)</span>

<span class="n">structure</span><span class="o">.</span><span class="n">calc</span> <span class="o">=</span> <span class="n">lmp_calc</span>

<span class="c1"># To compute energy, forces and stress</span>
<span class="c1"># energy = structure.get_potential_energy()</span>
<span class="c1"># forces = structure.get_forces()</span>
<span class="c1"># stress = structure.get_stress()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/Users/yuxie/opt/anaconda3/lib/python3.8/site-packages/ase/calculators/lammpsrun.py:191: UserWarning: You are using an old syntax to set &#39;parameters&#39;.
Please use LAMMPSRUN.set().
  warnings.warn(self.legacy_warn_string.format(&#34;parameters&#34;))
</pre></div></div>
</div>
<ol class="arabic simple" start="3">
<li><p>The third way to run LAMMPS is using our LAMMPS interface, please set the environment variable <code class="docutils literal notranslate"><span class="pre">$lmp</span></code> to the executable.</p></li>
</ol>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">flare</span><span class="w"> </span><span class="kn">import</span> <span class="n">struc</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flare.lammps</span><span class="w"> </span><span class="kn">import</span> <span class="n">lammps_calculator</span>

<span class="c1"># lmp coef file is automatically written now every time MGP is constructed</span>

<span class="c1"># create test structure</span>
<span class="n">species</span> <span class="o">=</span> <span class="n">otf_object</span><span class="o">.</span><span class="n">gp_species_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">otf_object</span><span class="o">.</span><span class="n">position_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">forces</span> <span class="o">=</span> <span class="n">otf_object</span><span class="o">.</span><span class="n">force_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">otf_cell</span> <span class="o">=</span> <span class="n">otf_object</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;cell&#39;</span><span class="p">]</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">struc</span><span class="o">.</span><span class="n">Structure</span><span class="p">(</span><span class="n">otf_cell</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span>

<span class="n">atom_types</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">atom_masses</span> <span class="o">=</span> <span class="p">[</span><span class="mi">108</span><span class="p">,</span> <span class="mi">127</span><span class="p">]</span>
<span class="n">atom_species</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="mi">27</span>

<span class="c1"># create data file</span>
<span class="n">data_file_name</span> <span class="o">=</span> <span class="s1">&#39;tmp.data&#39;</span>
<span class="n">data_text</span> <span class="o">=</span> <span class="n">lammps_calculator</span><span class="o">.</span><span class="n">lammps_dat</span><span class="p">(</span><span class="n">structure</span><span class="p">,</span> <span class="n">atom_types</span><span class="p">,</span>
                                         <span class="n">atom_masses</span><span class="p">,</span> <span class="n">atom_species</span><span class="p">)</span>
<span class="n">lammps_calculator</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">data_file_name</span><span class="p">,</span> <span class="n">data_text</span><span class="p">)</span>

<span class="c1"># create lammps input</span>
<span class="n">style_string</span> <span class="o">=</span> <span class="s1">&#39;mgp&#39;</span>
<span class="n">coeff_string</span> <span class="o">=</span> <span class="s1">&#39;* * </span><span class="si">{}</span><span class="s1"> Ag I yes yes&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lammps_location</span><span class="p">)</span>
<span class="n">lammps_executable</span> <span class="o">=</span> <span class="s1">&#39;$lmp&#39;</span>
<span class="n">dump_file_name</span> <span class="o">=</span> <span class="s1">&#39;tmp.dump&#39;</span>
<span class="n">input_file_name</span> <span class="o">=</span> <span class="s1">&#39;tmp.in&#39;</span>
<span class="n">output_file_name</span> <span class="o">=</span> <span class="s1">&#39;tmp.out&#39;</span>
<span class="n">input_text</span> <span class="o">=</span> \
    <span class="n">lammps_calculator</span><span class="o">.</span><span class="n">generic_lammps_input</span><span class="p">(</span><span class="n">data_file_name</span><span class="p">,</span> <span class="n">style_string</span><span class="p">,</span>
                                           <span class="n">coeff_string</span><span class="p">,</span> <span class="n">dump_file_name</span><span class="p">)</span>
<span class="n">lammps_calculator</span><span class="o">.</span><span class="n">write_text</span><span class="p">(</span><span class="n">input_file_name</span><span class="p">,</span> <span class="n">input_text</span><span class="p">)</span>

<span class="c1"># To run lammps and get forces</span>
<span class="c1"># lammps_calculator.run_lammps(lammps_executable, input_file_name,</span>
<span class="c1">#                              output_file_name)</span>

<span class="c1"># lammps_forces = lammps_calculator.lammps_parser(dump_file_name)</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gpfa.html" class="btn btn-neutral float-left" title="Training a 2+3-body Gaussian Process from an AIMD Run" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../flare/flare.html" class="btn btn-neutral float-right" title="Python Code Documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Jonathan Vandermause, Yu Xie, Anders Johansson, Cameron Owen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>