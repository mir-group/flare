

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapped Gaussian Process &mdash; flare 1.4.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=02f2166e"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Splines Methods" href="splines_methods.html" />
    <link rel="prev" title="FLARE ASE Calculator" href="../gp/calculator.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            flare
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/tutorials.html">Tutorials</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../flare.html">Python Code Documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../bffs.html">Bayesian Force Fields</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../gp/gp.html">Gaussian Process Force Fields</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Mapped Gaussian Process</a><ul>
<li class="toctree-l4"><a class="reference internal" href="splines_methods.html">Splines Methods</a></li>
<li class="toctree-l4"><a class="reference internal" href="formulas.html">Formulation of Mapped Gaussian Process</a></li>
<li class="toctree-l4"><a class="reference internal" href="#flare.bffs.mgp.mgp.MappedGaussianProcess"><code class="docutils literal notranslate"><span class="pre">MappedGaussianProcess</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../sgp/sgp.html">Sparse Gaussian Process Force Fields</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../learners/learners.html">Bayesian Active Learning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../md/md.html">ASE MD Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../descriptors/descriptors.html">Descriptors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kernels/kernels.html">Kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../io/io.html">File Input and Output</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../utils/utils.html">Utility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../flare_pp/flare_pp.html">C++ Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../faqs.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../related.html">Applications/Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/contribute.html">How To Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../citing.html">How to Cite</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">flare</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../flare.html">Python Code Documentation</a></li>
          <li class="breadcrumb-item"><a href="../bffs.html">Bayesian Force Fields</a></li>
      <li class="breadcrumb-item active">Mapped Gaussian Process</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/flare/bffs/mgp/mgp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mapped-gaussian-process">
<h1>Mapped Gaussian Process<a class="headerlink" href="#mapped-gaussian-process" title="Link to this heading">ÔÉÅ</a></h1>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="splines_methods.html">Splines Methods</a><ul>
<li class="toctree-l2"><a class="reference internal" href="splines_methods.html#flare.bffs.mgp.splines_methods.CubicSpline"><code class="docutils literal notranslate"><span class="pre">CubicSpline</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="splines_methods.html#flare.bffs.mgp.splines_methods.PCASplines"><code class="docutils literal notranslate"><span class="pre">PCASplines</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="splines_methods.html#flare.bffs.mgp.splines_methods.vec_eval_cubic_spline"><code class="docutils literal notranslate"><span class="pre">vec_eval_cubic_spline()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="formulas.html">Formulation of Mapped Gaussian Process</a><ul>
<li class="toctree-l2"><a class="reference internal" href="formulas.html#Energy">Energy</a></li>
<li class="toctree-l2"><a class="reference internal" href="formulas.html#Uncertainty">Uncertainty</a></li>
<li class="toctree-l2"><a class="reference internal" href="formulas.html#References">References</a></li>
</ul>
</li>
</ul>
</div>
<p id="module-flare.bffs.mgp.mgp"><a class="reference internal" href="#flare.bffs.mgp.mgp.MappedGaussianProcess" title="flare.bffs.mgp.mgp.MappedGaussianProcess"><code class="xref py py-class docutils literal notranslate"><span class="pre">MappedGaussianProcess</span></code></a> uses splines to build up interpolationfunction of the low-dimensional decomposition of Gaussian Process, with little loss of accuracy. Refer to <a class="reference external" href="https://arxiv.org/abs/2008.11796">Xie et al.</a>, <a class="reference external" href="https://www.nature.com/articles/s41524-020-0283-z">Vandermause et al.</a>, <a class="reference external" href="https://journals.aps.org/prb/abstract/10.1103/PhysRevB.97.184307">Glielmo et al.</a></p>
<dl class="py class">
<dt class="sig sig-object py" id="flare.bffs.mgp.mgp.MappedGaussianProcess">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">flare.bffs.mgp.mgp.</span></span><span class="sig-name descname"><span class="pre">MappedGaussianProcess</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">grid_params</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unique_species</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">list</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">GP</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference internal" href="../gp/gp.html#flare.bffs.gp.gp.GaussianProcess" title="flare.bffs.gp.gp.GaussianProcess"><span class="pre">GaussianProcess</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">var_map</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">container_only</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lmp_file_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'lmp'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_cpus</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_sample</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">int</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#flare.bffs.mgp.mgp.MappedGaussianProcess" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Build Mapped Gaussian Process (MGP)
and automatically save coefficients for LAMMPS pair style.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>grid_params</strong> (<em>dict</em>) ‚Äì Parameters for the mapping itself, such as
grid size of spline fit, etc. As described below.</p></li>
<li><p><strong>unique_species</strong> (<em>dict</em>) ‚Äì List of all the (unique) species included during
the training that need to be mapped</p></li>
<li><p><strong>GP</strong> (<em>GaussianProcess</em>) ‚Äì None or a GaussianProcess object. If a GP is input,
and container_only is False, automatically build a mapping corresponding
to the GaussianProcess.</p></li>
<li><p><strong>var_map</strong> (<em>str</em>) ‚Äì if None: only build mapping for mean (force). If ‚Äòpca‚Äô, then
use PCA to map the variance, based on <cite>grid_params[‚Äòxxbody‚Äô][‚Äòsvd_rank‚Äô]</cite>.
If ‚Äòsimple‚Äô, then only map the diagonal of covariance, and predict the
upper bound of variance. The ‚Äòpca‚Äô mode is much heavier in terms of
memory, but its prediction is much closer to GP variance.</p></li>
<li><p><strong>container_only</strong> (<em>bool</em>) ‚Äì if True: only build splines container
(with no coefficients); if False: Attempt to build map immediately</p></li>
<li><p><strong>lmp_file_name</strong> (<em>str</em>) ‚Äì LAMMPS coefficient file name</p></li>
<li><p><strong>n_cpus</strong> (<em>int</em>) ‚Äì Default None. Set to the number of cores needed for
parallelization. Used in the construction of the map.</p></li>
<li><p><strong>n_sample</strong> (<em>int</em>) ‚Äì Default 10. The batch size for building map. Not used now.</p></li>
</ul>
</dd>
</dl>
<p>Examples:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># build 2 + 3 body map</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grid_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;twobody&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;grid_num&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">]},</span>
<span class="gp">... </span>               <span class="s1">&#39;threebody&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;grid_num&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">]}}</span>
</pre></div>
</div>
<p>For <cite>grid_params</cite>, the following keys and values are allowed</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>‚Äòtwobody‚Äô</strong> (<em>dict, optional</em>) ‚Äì if 2-body is present, set as a dictionary
of parameters for 2-body mapping. Parameters see below.</p></li>
<li><p><strong>‚Äòthreebody‚Äô</strong> (<em>dict, optional</em>) ‚Äì if 3-body is present, set as a dictionary
of parameters for 3-body mapping. Parameters see below.</p></li>
<li><p><strong>‚Äòload_grid‚Äô</strong> (<em>str, optional</em>) ‚Äì Default None. the path to the directory
where the previously generated grids (<code class="docutils literal notranslate"><span class="pre">grid_*.npy</span></code>) are stored.
If no path is specified, MGP will construct grids from scratch.</p></li>
<li><p><strong>‚Äòlower_bound_relax‚Äô</strong> (<em>float, optional</em>) ‚Äì Default 0.1. if ‚Äòlower_bound‚Äô is
set to ‚Äòauto‚Äô this value will be used as a relaxation of lower
bound. (see below the description of ‚Äòlower_bound‚Äô)</p></li>
</ul>
</dd>
</dl>
<p>For two/three body parameter dictionary, the following keys and values are allowed</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>‚Äògrid_num‚Äô</strong> (<em>list</em>) ‚Äì a list of integers, the number of grid points for
interpolation. The larger the number, the better the approximation
of MGP is compared with GP.</p></li>
<li><p><strong>‚Äòlower_bound‚Äô</strong> (<em>str or list, optional</em>) ‚Äì Default ‚Äòauto‚Äô, the lower bound
of the spline interpolation will be searched. First, search the
training set of GP and find the minimal interatomic distance r_min.
Then, the <code class="docutils literal notranslate"><span class="pre">lower_bound</span> <span class="pre">=</span> <span class="pre">r_min</span> <span class="pre">-</span> <span class="pre">lower_bound_relax</span></code>. The user
can set their own lower_bound, of the same shape as ‚Äògrid_num‚Äô.
E.g. for threebody, the customized lower bound can be set as
[1.2, 1.2, 1.2].</p></li>
<li><p><strong>‚Äòupper_bound‚Äô</strong> (<em>str or list, optional</em>) ‚Äì Default ‚Äòauto‚Äô, the upper bound
of the spline interpolation will be the cutoffs of GP. The user
can set their own upper_bound, of the same shape as ‚Äògrid_num‚Äô.
E.g. for threebody, the customized lower bound can be set as
[3.5, 3.5, 3.5].</p></li>
<li><p><strong>‚Äòsvd_rank‚Äô</strong> (<em>int, optional</em>) ‚Äì Default ‚Äòauto‚Äô. If the variance mapping is
needed, it is set as the rank of the mapping. ‚Äòauto‚Äô uses full
rank, which is the smaller one between the total number of grid
points and training set size. i.e.
<code class="docutils literal notranslate"><span class="pre">full_rank</span> <span class="pre">=</span> <span class="pre">min(np.prod(grid_num),</span> <span class="pre">3</span> <span class="pre">*</span> <span class="pre">N_train)</span></code></p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="flare.bffs.mgp.mgp.MappedGaussianProcess.as_dict">
<span class="sig-name descname"><span class="pre">as_dict</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">dict</span></span></span><a class="headerlink" href="#flare.bffs.mgp.mgp.MappedGaussianProcess.as_dict" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Dictionary representation of the MGP model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="flare.bffs.mgp.mgp.MappedGaussianProcess.from_dict">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">from_dict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dictionary</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">dict</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference internal" href="#flare.bffs.mgp.mgp.MappedGaussianProcess" title="flare.bffs.mgp.mgp.MappedGaussianProcess"><span class="pre">MappedGaussianProcess</span></a></span></span><a class="headerlink" href="#flare.bffs.mgp.mgp.MappedGaussianProcess.from_dict" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Create MGP object from dictionary representation.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="flare.bffs.mgp.mgp.MappedGaussianProcess.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">atom_env:</span> <span class="pre">~flare.descriptors.env.AtomicEnvironment)</span> <span class="pre">-&gt;</span> <span class="pre">('ndarray'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">'ndarray'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">'ndarray'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">&lt;class</span> <span class="pre">'float'&gt;</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#flare.bffs.mgp.mgp.MappedGaussianProcess.predict" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>predict force, variance, stress and local energy for given
atomic environment</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>atom_env</strong> ‚Äì atomic environment (with a center atom and its neighbors)</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>3d array of atomic force
variance: 3d array of the predictive variance
stress: 6d array of the virial stress
energy: the local energy (atomic energy)</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>force</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="flare.bffs.mgp.mgp.MappedGaussianProcess.write_lmp_file">
<span class="sig-name descname"><span class="pre">write_lmp_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">lammps_name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_var</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#flare.bffs.mgp.mgp.MappedGaussianProcess.write_lmp_file" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>write the coefficients to a file that can be used by lammps pair style</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="flare.bffs.mgp.mgp.MappedGaussianProcess.write_model">
<span class="sig-name descname"><span class="pre">write_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">format</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">str</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'json'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#flare.bffs.mgp.mgp.MappedGaussianProcess.write_model" title="Link to this definition">ÔÉÅ</a></dt>
<dd><p>Write everything necessary to re-load and re-use the model
:param model_name:
:return:</p>
</dd></dl>

</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../gp/calculator.html" class="btn btn-neutral float-left" title="FLARE ASE Calculator" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="splines_methods.html" class="btn btn-neutral float-right" title="Splines Methods" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Jonathan Vandermause, Yu Xie, Anders Johansson, Cameron Owen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>